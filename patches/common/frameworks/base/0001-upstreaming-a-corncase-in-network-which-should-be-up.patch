From 2e83b53fd60bcde1b5d004d9fcf87cdfed97bf70 Mon Sep 17 00:00:00 2001
From: Bin Yang <bin.y.yang@intel.com>
Date: Sun, 2 Jun 2019 19:39:55 +0800
Subject: [PATCH] [upstreaming] a corncase in network, which should be
 upstreaming

Change-Id: Ia965259d1a2eb053440df417ee621f320ec711f0
Tracked-On:
Signed-off-by: Bin Yang <bin.y.yang@intel.com>
---
 .../com/android/server/net/NetworkPolicyManagerService.java | 6 ++++++
 1 file changed, 6 insertions(+)
 mode change 100644 => 100755 services/core/java/com/android/server/net/NetworkPolicyManagerService.java

diff --git a/services/core/java/com/android/server/net/NetworkPolicyManagerService.java b/services/core/java/com/android/server/net/NetworkPolicyManagerService.java
old mode 100644
new mode 100755
index ab482bb2da9..7f7a193e0c3
--- a/services/core/java/com/android/server/net/NetworkPolicyManagerService.java
+++ b/services/core/java/com/android/server/net/NetworkPolicyManagerService.java
@@ -712,6 +712,12 @@ public class NetworkPolicyManagerService extends INetworkPolicyManager.Stub {
             Process.setThreadPriority(Process.THREAD_PRIORITY_FOREGROUND);
             if (!isBandwidthControlEnabled()) {
                 Slog.w(TAG, "bandwidth controls disabled, unable to enforce policy");
+				/*_ANDROID_AS_GUEST_ It seems it is a bug fixing, it should be upstreaming*/
+                mUsageStats = LocalServices.getService(UsageStatsManagerInternal.class);
+                mNetworkStats = LocalServices.getService(NetworkStatsManagerInternal.class);
+                mPowerManagerInternal = LocalServices.getService(PowerManagerInternal.class);
+                mActivityManagerInternal = LocalServices.getService(ActivityManagerInternal.class);
+                initCompleteSignal.countDown();
                 return;
             }
 
-- 
2.17.1

