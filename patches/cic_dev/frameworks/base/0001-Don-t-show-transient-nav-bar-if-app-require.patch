From 3c4caefe38514fd1d41f598391be2975cd316bc1 Mon Sep 17 00:00:00 2001
From: Hongcheng Xie <hongcheng.xie@intel.com>
Date: Tue, 14 Jan 2020 22:07:45 +0800
Subject: [PATCH] Don't show transient nav bar if app require

Change-Id: I73c15e0ba063828438bd6ee9122894c77d2376ae
Tracked-On: OAM-88993
Signed-off-by: Hongcheng Xie <hongcheng.xie@intel.com>
---
 .../com/android/server/policy/PhoneWindowManager.java     | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/services/core/java/com/android/server/policy/PhoneWindowManager.java b/services/core/java/com/android/server/policy/PhoneWindowManager.java
index 7d6b896b9f0..82e7ecff014 100644
--- a/services/core/java/com/android/server/policy/PhoneWindowManager.java
+++ b/services/core/java/com/android/server/policy/PhoneWindowManager.java
@@ -6764,6 +6764,10 @@ public class PhoneWindowManager implements WindowManagerPolicy {
             boolean sb = mStatusBarController.checkShowTransientBarLw();
             boolean nb = mNavigationBarController.checkShowTransientBarLw()
                     && !isNavBarEmpty(mLastSystemUiFlags);
+            if (isForceDisableNavBar()) {
+                Slog.i(TAG, "Don't show nav bar since app force disable it");
+                nb = false;
+            }
             if (sb || nb) {
                 // Don't show status bar when swiping on already visible navigation bar
                 if (!nb && swipeTarget == mNavigationBar) {
@@ -8496,6 +8500,10 @@ public class PhoneWindowManager implements WindowManagerPolicy {
         return mHasNavigationBar;
     }
 
+    private boolean isForceDisableNavBar() {
+        return SystemProperties.getBoolean("sys.disable.nav.bar", false);
+    }
+
     @Override
     public void setLastInputMethodWindowLw(WindowState ime, WindowState target) {
         mLastInputMethodWindow = ime;
-- 
2.17.1

